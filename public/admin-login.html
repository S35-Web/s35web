<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S-35 Admin | Acceso de Colaboradores</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --overlay: rgba(0,0,0,.55); }
        body { margin: 0; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-weight: 300; }
        .page {
            min-height: 100vh;
            position: relative;
            display: grid;
            place-items: center;
            overflow: hidden;
            background: #000;
        }
        .bg-video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; object-position: center; filter: saturate(0.9) brightness(0.9); }
        /* Quitar ocultamiento en móviles para iOS */
        /* Si el rendimiento es bajo, podemos reactivar este media query con una imagen */
        @media (max-width: 480px){ .bg-video{ display:none; } .overlay{ background: linear-gradient(180deg, rgba(0,0,0,.7), rgba(0,0,0,.9)); } }
        .overlay { position: absolute; inset: 0; background: radial-gradient(1200px 600px at 70% 20%, rgba(0,0,0,.15), transparent), linear-gradient(180deg, var(--overlay), rgba(0,0,0,.75)); }
        .card {
            position: relative;
            width: min(92vw, 420px);
            border-radius: 20px;
            background: transparent;
            border: 0;
            backdrop-filter: none;
            box-shadow: none;
            padding: 48px 0;
        }
        .logo { display: grid; place-items: center; margin-bottom: 18px; }
        .logo img { height: 40px; width: auto; }
        .title { margin: 0 0 10px; color: #fff; font-weight: 300; letter-spacing: .4px; font-size: 28px; text-align: center; }
        .subtitle { margin: 0 0 28px; color: #bfbfbf; font-weight: 300; font-size: 14px; text-align: center; }
        .form { display: grid; gap: 20px; }
        .label { color: #e8e8e8; font-size: 12px; margin-bottom: 6px; letter-spacing: .3px; }
        .input { width: 100%; padding: 16px 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,.18); background: rgba(255,255,255,.06); color: #fff; outline: none; transition: border-color .2s, background .2s; font-weight: 300; }
        .input::placeholder { color: #9aa0a6; }
        .input:focus { border-color: #4da3ff; background: rgba(255,255,255,.1); }
        .btn { width: 100%; padding: 16px 18px; border-radius: 12px; border: 0; background: linear-gradient(135deg,#0a84ff,#0066cc); color: #fff; font-weight: 500; letter-spacing: .2px; cursor: pointer; box-shadow: 0 12px 30px rgba(10,132,255,.25); transition: transform .15s ease; }
        .btn:hover { transform: translateY(-1px); }
        .error { display: none; margin-top: 8px; border-radius: 12px; border: 1px solid rgba(239,68,68,.35); background: rgba(239,68,68,.08); color: #fca5a5; padding: 12px 14px; font-size: 13px; }
        .back { text-align: center; margin-top: 18px; }
        .back a { color: #c7c7c7; text-decoration: none; font-size: 13px; }
        @media (max-width: 640px){ .card{ padding: 44px 24px; width: min(88vw, 440px);} body{background:#000} }
    </style>
</head>
<body>
    <div class="page">
        <video class="bg-video" autoplay muted loop playsinline webkit-playsinline preload="metadata" poster="Assets/contact.jpg">
            <source src="Assets/colaboradores_background.mp4" type="video/mp4">
        </video>
        <div class="overlay"></div>

        <div class="card">
            <div class="logo"><img src="Assets/Logotipo Principal.png" alt="S-35 Technology"></div>
            <h1 class="title">Acceso de Colaboradores</h1>
            <p class="subtitle">Sistema de administración S-35</p>
            <form class="form" id="loginForm">
                <div>
                    <div class="label">Usuario</div>
                    <input class="input" id="username" name="username" type="text" placeholder="Ingresa tu usuario" required>
                </div>
                <div>
                    <div class="label">Contraseña</div>
                    <input class="input" id="password" name="password" type="password" placeholder="Ingresa tu contraseña" required>
                </div>
                <button type="submit" class="btn" id="loginBtn"><i class="fas fa-sign-in-alt"></i> Iniciar Sesión</button>
                <div class="error" id="errorMessage"></div>
            </form>
            <div class="back"><a href="index.html"><i class="fas fa-arrow-left"></i> Volver al sitio principal</a></div>
        </div>
    </div>

    <script>
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
            errorMessage.style.display = 'none';
            try {
                const response = await fetch(window.location.origin + '/api/admin-login', {
                    method: 'POST',
                    mode: 'same-origin',
                    credentials: 'same-origin',
                    cache: 'no-store',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password, userType: 'colaboradores' })
                });
                let data;
                try { data = await response.json(); } catch(parseErr){
                    throw new Error('Respuesta no válida del servidor');
                }
                if (data.success) {
                    localStorage.setItem('adminToken', data.token);
                    localStorage.setItem('userType', 'colaboradores');
                    window.location.href = 'admin-dashboard.html';
                } else {
                    errorMessage.textContent = data.message || 'Credenciales incorrectas';
                    errorMessage.style.display = 'block';
                }
            } catch (err) {
                errorMessage.textContent = 'Error de conexión. Intenta nuevamente.';
                errorMessage.style.display = 'block';
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Iniciar Sesión';
            }
        });
    </script>
</body>
</html>
